import React, { useEffect } from "react";

export default function CCBSHomepage(): JSX.Element {
  useEffect(() => {
    // set year text
    const yearEl = document.getElementById("year");
    if (yearEl) yearEl.textContent = String(new Date().getFullYear());

    // active nav underline on scroll
    const sections = Array.from(document.querySelectorAll("main section")) as HTMLElement[];
    const navLinks = Array.from(document.querySelectorAll(".nav-link")) as HTMLElement[];

    function onScroll() {
      const y = window.scrollY + 120;
      let current = sections[0];
      for (const sec of sections) {
        if (sec.offsetTop <= y) current = sec;
      }
      navLinks.forEach((a) => {
        const href = a.getAttribute("href");
        a.classList.toggle("active", href === `#${current?.id ?? ""}`);
      });
    }

    window.addEventListener("scroll", onScroll, { passive: true });
    onScroll();

    // form submit handling (client-side placeholder)
    const form = document.getElementById("requestForm") as HTMLFormElement | null;
    const resp = document.getElementById("formResponse") as HTMLElement | null;
    const SCRIPT_URL = ""; // set your Apps Script / API URL here

    const handleSubmit = async (e: Event) => {
      e.preventDefault();
      if (resp) resp.textContent = "Sending...";
      try {
        const fd = new FormData(form as HTMLFormElement);
        if (SCRIPT_URL) {
          await fetch(SCRIPT_URL, { method: "POST", body: fd });
        } else {
          // fake delay for preview
          await new Promise((r) => setTimeout(r, 600));
        }
        if (resp) resp.textContent = "✅ Thanks! Your request has been submitted.";
        form?.reset();
      } catch (err) {
        if (resp) resp.textContent = "❌ Error submitting. Please try again.";
      }
    };

    if (form) form.addEventListener("submit", handleSubmit);

    return () => {
      window.removeEventListener("scroll", onScroll);
      if (form) form.removeEventListener("submit", handleSubmit);
    };
  }, []);

  return (
    <div style={{ background: "#F7F7FB", color: "#222" }}>
      <style>{`
        :root{--purple:#6A0DAD;--yellow:#FFD700;--black:#000;--white:#fff;--bg:#F7F7FB;--card:#fff;--stroke:#E9E9EF}
        *{box-sizing:border-box}
        body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#222}
        a{color:inherit;text-decoration:none}
        .container{max-width:1100px;margin:0 auto;padding:0 20px}
        header{background:var(--white);border-bottom:1px solid var(--stroke);}
        .topbar{display:flex;align-items:center;justify-content:space-between;padding:18px 0}
        .brand{display:flex;align-items:center;gap:12px}
        .brand img{height:44px}
        .brand .title{line-height:1}
        .brand .title .name{font-weight:700;color:var(--purple)}
        .brand .title .tag{font-size:13px;color:#666}
        nav{display:flex;gap:18px;align-items:center}
        .nav-link{position:relative;padding:10px 8px;font-weight:600;font-size:16px;color:#111;border-radius:8px}
        .nav-link:hover{background:#fafafa}
        .nav-link::after{content:"";position:absolute;left:12px;right:12px;height:4px;border-radius:4px;bottom:6px;transform:scaleX(0);transform-origin:center;transition:transform .25s ease,background .25s}
        .nav-link.active::after{transform:scaleX(1);background:var(--yellow)}
        .cta{background:var(--purple);color:var(--white);padding:10px 14px;border-radius:12px;font-weight:700}
        .hero{background:var(--white);padding:48px 0}
        .hero-grid{display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center}
        .eyebrow{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(106,13,173,0.08);color:var(--purple);font-weight:700;font-size:13px}
        h1{margin:12px 0 6px;font-size:30px;line-height:1.05;color:#111}
        p.lead{color:#555;font-size:15px}
        .btns{margin-top:16px;display:flex;gap:12px}
        .btn{padding:12px 16px;border-radius:12px;font-weight:700}
        .btn.primary{background:var(--purple);color:var(--white)}
        .btn.ghost{border:1px solid var(--purple);color:var(--purple);background:transparent}
        section{padding:36px 0}
        .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
        .card{background:var(--card);border:1px solid var(--stroke);border-radius:12px;padding:18px}
        .card h3{margin:0 0 8px;color:var(--purple);font-size:16px}
        .sec-title{display:flex;align-items:flex-end;gap:12px}
        .sec-title h2{margin:0;font-size:22px}
        .sec-title .bar{height:8px;width:64px;background:var(--yellow);border-radius:999px}
        .form-card{max-width:620px;margin:0 auto;background:var(--card);padding:20px;border-radius:12px;border:1px solid var(--stroke)}
        label{display:block;margin-bottom:6px;font-weight:600}
        input,textarea{width:100%;padding:10px;border:1px solid #d3d7df;border-radius:10px}
        button[type=submit]{background:var(--purple);color:var(--white);border:none;padding:12px 16px;border-radius:999px;font-weight:700;cursor:pointer}
        footer{padding:28px 0;text-align:center;color:#666}
        @media (max-width:900px){.hero-grid{grid-template-columns:1fr}.nav-link{font-size:15px}.brand img{height:36px}}
      `}</style>

      <header>
        <div className="container topbar">
          <div className="brand">
            <img
              src="/logo-ccbs.png"
              alt="CCBS logo"
              onError={(e) => {
                const el = e.currentTarget as HTMLImageElement;
                el.style.display = "none";
              }}
            />
            <div className="title">
              <div className="name">CrystalCore Business Solutions</div>
              <div className="tag">Business Analyst & Consultant</div>
            </div>
          </div>

          <nav id="mainNav">
            <a className="nav-link" href="#about" data-section="about">
              About
            </a>
            <a className="nav-link" href="#services" data-section="services">
              Services
            </a>
            <a className="nav-link" href="#why" data-section="why">
              Why Choose Us
            </a>
            <a className="nav-link" href="#request" data-section="request">
              Request
            </a>
            <a className="nav-link" href="#contact" data-section="contact">
              Contact
            </a>
            <a className="cta" href="#contact">
              Book Consultation
            </a>
          </nav>
        </div>
      </header>

      <main>
        <section className="hero">
          <div className="container hero-grid">
            <div>
              <div className="eyebrow">Business Analyst & Consultant Service</div>
              <h1>Transforming businesses with smart analysis & strategy</h1>
              <p className="lead">We help startups and SMEs align processes, requirements, and technology to drive sustainable growth.</p>
              <div className="btns">
                <a className="btn primary" href="#contact">
                  Book a Consultation
                </a>
                <a className="btn ghost" href="#services">
                  Explore Services
                </a>
              </div>
            </div>
            <aside>
              <div className="card">
                <h3>Quick Services</h3>
                <ul>
                  <li>Business Analysis Planning</li>
                  <li>BRD / FRD / SRS</li>
                  <li>CRM / ERP Selection</li>
                  <li>Market & Competitor Analysis</li>
                </ul>
              </div>
            </aside>
          </div>
        </section>

        <section id="services">
          <div className="container">
            <div className="sec-title">
              <h2>Our Services</h2>
              <div className="bar" aria-hidden="true" />
            </div>
            <div className="grid" style={{ marginTop: 18 }}>
              <div className="card">
                <h3>Business Analysis & Planning</h3>
                <p>Planning, BRD/FRD, health-check</p>
              </div>
              <div className="card">
                <h3>Digital Transformation</h3>
                <p>CRM/ERP, automation</p>
              </div>
              <div className="card">
                <h3>Data & Reporting</h3>
                <p>Dashboards, KPIs</p>
              </div>
              <div className="card">
                <h3>Market Research</h3>
                <p>Competitor analysis</p>
              </div>
              <div className="card">
                <h3>Project Management</h3>
                <p>Delivery & governance</p>
              </div>
              <div className="card">
                <h3>Compliance & Risk</h3>
                <p>Financial & regulatory</p>
              </div>
            </div>
          </div>
        </section>

        <section id="why">
          <div className="container">
            <div className="sec-title">
              <h2>Why Choose Us</h2>
              <div className="bar" aria-hidden="true" />
            </div>
            <p className="lead">We simplify complexity and deliver measurable results through tailored solutions and proven methods.</p>
          </div>
        </section>

        <section id="request">
          <div className="container">
            <div className="form-card">
              <h3>Request a Consultation</h3>
              <form id="requestForm">
                <label htmlFor="name">Name</label>
                <input id="name" name="name" required />
                <label htmlFor="email">Email</label>
                <input id="email" name="email" type="email" required />
                <label htmlFor="phone">Phone</label>
                <input id="phone" name="phone" required />
                <label htmlFor="message">Message</label>
                <textarea id="message" name="message" />
                <div style={{ marginTop: 10 }}>
                  <button type="submit">Submit Request</button>
                </div>
                <p id="formResponse" style={{ fontWeight: 700, marginTop: 8 }} />
              </form>
            </div>
          </div>
        </section>

        <section id="contact">
          <div className="container" style={{ textAlign: "center" }}>
            <h2>Contact</h2>
            <p className="lead">
              Email: <a href="mailto:saravana.akconsult@gmail.com">saravana.akconsult@gmail.com</a> · Phone: <a href="tel:+919840407627">+91 98404 07627</a>
            </p>
          </div>
        </section>
      </main>

      <footer>
        <div className="container">
          © <span id="year" /> CrystalCore Business Solutions — All rights reserved
        </div>
      </footer>
    </div>
  );
}
